{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nexports['default'] = createFieldsStore;\n\nvar _set = require('lodash/set');\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _createFormField = require('./createFormField');\n\nvar _createFormField2 = _interopRequireDefault(_createFormField);\n\nvar _utils = require('./utils');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    'default': obj\n  };\n}\n\nfunction partOf(a, b) {\n  return b.indexOf(a) === 0 && ['.', '['].indexOf(b[a.length]) !== -1;\n}\n\nfunction internalFlattenFields(fields) {\n  return (0, _utils.flattenFields)(fields, function (_, node) {\n    return (0, _createFormField.isFormField)(node);\n  }, 'You must wrap field data with `createFormField`.');\n}\n\nvar FieldsStore = function () {\n  function FieldsStore(fields) {\n    (0, _classCallCheck3['default'])(this, FieldsStore);\n\n    _initialiseProps.call(this);\n\n    this.fields = internalFlattenFields(fields);\n    this.fieldsMeta = {};\n  }\n\n  (0, _createClass3['default'])(FieldsStore, [{\n    key: 'updateFields',\n    value: function updateFields(fields) {\n      this.fields = internalFlattenFields(fields);\n    }\n  }, {\n    key: 'flattenRegisteredFields',\n    value: function flattenRegisteredFields(fields) {\n      var validFieldsName = this.getAllFieldsName();\n      return (0, _utils.flattenFields)(fields, function (path) {\n        return validFieldsName.indexOf(path) >= 0;\n      }, 'You cannot set a form field before rendering a field associated with the value.');\n    }\n  }, {\n    key: 'setFields',\n    value: function setFields(fields) {\n      var _this = this;\n\n      var fieldsMeta = this.fieldsMeta;\n      var nowFields = (0, _extends3['default'])({}, this.fields, fields);\n      var nowValues = {};\n      Object.keys(fieldsMeta).forEach(function (f) {\n        nowValues[f] = _this.getValueFromFields(f, nowFields);\n      });\n      Object.keys(nowValues).forEach(function (f) {\n        var value = nowValues[f];\n\n        var fieldMeta = _this.getFieldMeta(f);\n\n        if (fieldMeta && fieldMeta.normalize) {\n          var nowValue = fieldMeta.normalize(value, _this.getValueFromFields(f, _this.fields), nowValues);\n\n          if (nowValue !== value) {\n            nowFields[f] = (0, _extends3['default'])({}, nowFields[f], {\n              value: nowValue\n            });\n          }\n        }\n      });\n      this.fields = nowFields;\n    }\n  }, {\n    key: 'resetFields',\n    value: function resetFields(ns) {\n      var fields = this.fields;\n      var names = ns ? this.getValidFieldsFullName(ns) : this.getAllFieldsName();\n      return names.reduce(function (acc, name) {\n        var field = fields[name];\n\n        if (field && 'value' in field) {\n          acc[name] = {};\n        }\n\n        return acc;\n      }, {});\n    }\n  }, {\n    key: 'setFieldMeta',\n    value: function setFieldMeta(name, meta) {\n      this.fieldsMeta[name] = meta;\n    }\n  }, {\n    key: 'setFieldsAsDirty',\n    value: function setFieldsAsDirty() {\n      var _this2 = this;\n\n      Object.keys(this.fields).forEach(function (name) {\n        var field = _this2.fields[name];\n        var fieldMeta = _this2.fieldsMeta[name];\n\n        if (field && fieldMeta && (0, _utils.hasRules)(fieldMeta.validate)) {\n          _this2.fields[name] = (0, _extends3['default'])({}, field, {\n            dirty: true\n          });\n        }\n      });\n    }\n  }, {\n    key: 'getFieldMeta',\n    value: function getFieldMeta(name) {\n      this.fieldsMeta[name] = this.fieldsMeta[name] || {};\n      return this.fieldsMeta[name];\n    }\n  }, {\n    key: 'getValueFromFields',\n    value: function getValueFromFields(name, fields) {\n      var field = fields[name];\n\n      if (field && 'value' in field) {\n        return field.value;\n      }\n\n      var fieldMeta = this.getFieldMeta(name);\n      return fieldMeta && fieldMeta.initialValue;\n    }\n  }, {\n    key: 'getValidFieldsName',\n    value: function getValidFieldsName() {\n      var _this3 = this;\n\n      var fieldsMeta = this.fieldsMeta;\n      return fieldsMeta ? Object.keys(fieldsMeta).filter(function (name) {\n        return !_this3.getFieldMeta(name).hidden;\n      }) : [];\n    }\n  }, {\n    key: 'getAllFieldsName',\n    value: function getAllFieldsName() {\n      var fieldsMeta = this.fieldsMeta;\n      return fieldsMeta ? Object.keys(fieldsMeta) : [];\n    }\n  }, {\n    key: 'getValidFieldsFullName',\n    value: function getValidFieldsFullName(maybePartialName) {\n      var maybePartialNames = Array.isArray(maybePartialName) ? maybePartialName : [maybePartialName];\n      return this.getValidFieldsName().filter(function (fullName) {\n        return maybePartialNames.some(function (partialName) {\n          return fullName === partialName || (0, _utils.startsWith)(fullName, partialName) && ['.', '['].indexOf(fullName[partialName.length]) >= 0;\n        });\n      });\n    }\n  }, {\n    key: 'getFieldValuePropValue',\n    value: function getFieldValuePropValue(fieldMeta) {\n      var name = fieldMeta.name,\n          getValueProps = fieldMeta.getValueProps,\n          valuePropName = fieldMeta.valuePropName;\n      var field = this.getField(name);\n      var fieldValue = 'value' in field ? field.value : fieldMeta.initialValue;\n\n      if (getValueProps) {\n        return getValueProps(fieldValue);\n      }\n\n      return (0, _defineProperty3['default'])({}, valuePropName, fieldValue);\n    }\n  }, {\n    key: 'getField',\n    value: function getField(name) {\n      return (0, _extends3['default'])({}, this.fields[name], {\n        name: name\n      });\n    }\n  }, {\n    key: 'getNotCollectedFields',\n    value: function getNotCollectedFields() {\n      var _this4 = this;\n\n      var fieldsName = this.getValidFieldsName();\n      return fieldsName.filter(function (name) {\n        return !_this4.fields[name];\n      }).map(function (name) {\n        return {\n          name: name,\n          dirty: false,\n          value: _this4.getFieldMeta(name).initialValue\n        };\n      }).reduce(function (acc, field) {\n        return (0, _set2['default'])(acc, field.name, (0, _createFormField2['default'])(field));\n      }, {});\n    }\n  }, {\n    key: 'getNestedAllFields',\n    value: function getNestedAllFields() {\n      var _this5 = this;\n\n      return Object.keys(this.fields).reduce(function (acc, name) {\n        return (0, _set2['default'])(acc, name, (0, _createFormField2['default'])(_this5.fields[name]));\n      }, this.getNotCollectedFields());\n    }\n  }, {\n    key: 'getFieldMember',\n    value: function getFieldMember(name, member) {\n      return this.getField(name)[member];\n    }\n  }, {\n    key: 'getNestedFields',\n    value: function getNestedFields(names, getter) {\n      var fields = names || this.getValidFieldsName();\n      return fields.reduce(function (acc, f) {\n        return (0, _set2['default'])(acc, f, getter(f));\n      }, {});\n    }\n  }, {\n    key: 'getNestedField',\n    value: function getNestedField(name, getter) {\n      var fullNames = this.getValidFieldsFullName(name);\n\n      if (fullNames.length === 0 || // Not registered\n      fullNames.length === 1 && fullNames[0] === name // Name already is full name.\n      ) {\n          return getter(name);\n        }\n\n      var isArrayValue = fullNames[0][name.length] === '[';\n      var suffixNameStartIndex = isArrayValue ? name.length : name.length + 1;\n      return fullNames.reduce(function (acc, fullName) {\n        return (0, _set2['default'])(acc, fullName.slice(suffixNameStartIndex), getter(fullName));\n      }, isArrayValue ? [] : {});\n    }\n  }, {\n    key: 'isValidNestedFieldName',\n    // @private\n    // BG: `a` and `a.b` cannot be use in the same form\n    value: function isValidNestedFieldName(name) {\n      var names = this.getAllFieldsName();\n      return names.every(function (n) {\n        return !partOf(n, name) && !partOf(name, n);\n      });\n    }\n  }, {\n    key: 'clearField',\n    value: function clearField(name) {\n      delete this.fields[name];\n      delete this.fieldsMeta[name];\n    }\n  }]);\n  return FieldsStore;\n}();\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this6 = this;\n\n  this.setFieldsInitialValue = function (initialValues) {\n    var flattenedInitialValues = _this6.flattenRegisteredFields(initialValues);\n\n    var fieldsMeta = _this6.fieldsMeta;\n    Object.keys(flattenedInitialValues).forEach(function (name) {\n      if (fieldsMeta[name]) {\n        _this6.setFieldMeta(name, (0, _extends3['default'])({}, _this6.getFieldMeta(name), {\n          initialValue: flattenedInitialValues[name]\n        }));\n      }\n    });\n  };\n\n  this.getAllValues = function () {\n    var fieldsMeta = _this6.fieldsMeta,\n        fields = _this6.fields;\n    return Object.keys(fieldsMeta).reduce(function (acc, name) {\n      return (0, _set2['default'])(acc, name, _this6.getValueFromFields(name, fields));\n    }, {});\n  };\n\n  this.getFieldsValue = function (names) {\n    return _this6.getNestedFields(names, _this6.getFieldValue);\n  };\n\n  this.getFieldValue = function (name) {\n    var fields = _this6.fields;\n    return _this6.getNestedField(name, function (fullName) {\n      return _this6.getValueFromFields(fullName, fields);\n    });\n  };\n\n  this.getFieldsError = function (names) {\n    return _this6.getNestedFields(names, _this6.getFieldError);\n  };\n\n  this.getFieldError = function (name) {\n    return _this6.getNestedField(name, function (fullName) {\n      return (0, _utils.getErrorStrs)(_this6.getFieldMember(fullName, 'errors'));\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    return _this6.getFieldMember(name, 'validating');\n  };\n\n  this.isFieldsValidating = function (ns) {\n    var names = ns || _this6.getValidFieldsName();\n\n    return names.some(function (n) {\n      return _this6.isFieldValidating(n);\n    });\n  };\n\n  this.isFieldTouched = function (name) {\n    return _this6.getFieldMember(name, 'touched');\n  };\n\n  this.isFieldsTouched = function (ns) {\n    var names = ns || _this6.getValidFieldsName();\n\n    return names.some(function (n) {\n      return _this6.isFieldTouched(n);\n    });\n  };\n};\n\nfunction createFieldsStore(fields) {\n  return new FieldsStore(fields);\n}\n\nmodule.exports = exports['default'];","map":{"version":3,"sources":["/Users/xumeihong/Documents/code/git/react/demos/demo2/node_modules/rc-form/lib/createFieldsStore.js"],"names":["Object","defineProperty","exports","value","_defineProperty2","require","_defineProperty3","_interopRequireDefault","_extends2","_extends3","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","createFieldsStore","_set","_set2","_createFormField","_createFormField2","_utils","obj","__esModule","partOf","a","b","indexOf","length","internalFlattenFields","fields","flattenFields","_","node","isFormField","FieldsStore","_initialiseProps","call","fieldsMeta","key","updateFields","flattenRegisteredFields","validFieldsName","getAllFieldsName","path","setFields","_this","nowFields","nowValues","keys","forEach","f","getValueFromFields","fieldMeta","getFieldMeta","normalize","nowValue","resetFields","ns","names","getValidFieldsFullName","reduce","acc","name","field","setFieldMeta","meta","setFieldsAsDirty","_this2","hasRules","validate","dirty","initialValue","getValidFieldsName","_this3","filter","hidden","maybePartialName","maybePartialNames","Array","isArray","fullName","some","partialName","startsWith","getFieldValuePropValue","getValueProps","valuePropName","getField","fieldValue","getNotCollectedFields","_this4","fieldsName","map","getNestedAllFields","_this5","getFieldMember","member","getNestedFields","getter","getNestedField","fullNames","isArrayValue","suffixNameStartIndex","slice","isValidNestedFieldName","every","n","clearField","_this6","setFieldsInitialValue","initialValues","flattenedInitialValues","getAllValues","getFieldsValue","getFieldValue","getFieldsError","getFieldError","getErrorStrs","isFieldValidating","isFieldsValidating","isFieldTouched","isFieldsTouched","module"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nexports['default'] = createFieldsStore;\n\nvar _set = require('lodash/set');\n\nvar _set2 = _interopRequireDefault(_set);\n\nvar _createFormField = require('./createFormField');\n\nvar _createFormField2 = _interopRequireDefault(_createFormField);\n\nvar _utils = require('./utils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nfunction partOf(a, b) {\n  return b.indexOf(a) === 0 && ['.', '['].indexOf(b[a.length]) !== -1;\n}\n\nfunction internalFlattenFields(fields) {\n  return (0, _utils.flattenFields)(fields, function (_, node) {\n    return (0, _createFormField.isFormField)(node);\n  }, 'You must wrap field data with `createFormField`.');\n}\n\nvar FieldsStore = function () {\n  function FieldsStore(fields) {\n    (0, _classCallCheck3['default'])(this, FieldsStore);\n\n    _initialiseProps.call(this);\n\n    this.fields = internalFlattenFields(fields);\n    this.fieldsMeta = {};\n  }\n\n  (0, _createClass3['default'])(FieldsStore, [{\n    key: 'updateFields',\n    value: function updateFields(fields) {\n      this.fields = internalFlattenFields(fields);\n    }\n  }, {\n    key: 'flattenRegisteredFields',\n    value: function flattenRegisteredFields(fields) {\n      var validFieldsName = this.getAllFieldsName();\n      return (0, _utils.flattenFields)(fields, function (path) {\n        return validFieldsName.indexOf(path) >= 0;\n      }, 'You cannot set a form field before rendering a field associated with the value.');\n    }\n  }, {\n    key: 'setFields',\n    value: function setFields(fields) {\n      var _this = this;\n\n      var fieldsMeta = this.fieldsMeta;\n      var nowFields = (0, _extends3['default'])({}, this.fields, fields);\n      var nowValues = {};\n      Object.keys(fieldsMeta).forEach(function (f) {\n        nowValues[f] = _this.getValueFromFields(f, nowFields);\n      });\n      Object.keys(nowValues).forEach(function (f) {\n        var value = nowValues[f];\n        var fieldMeta = _this.getFieldMeta(f);\n        if (fieldMeta && fieldMeta.normalize) {\n          var nowValue = fieldMeta.normalize(value, _this.getValueFromFields(f, _this.fields), nowValues);\n          if (nowValue !== value) {\n            nowFields[f] = (0, _extends3['default'])({}, nowFields[f], {\n              value: nowValue\n            });\n          }\n        }\n      });\n      this.fields = nowFields;\n    }\n  }, {\n    key: 'resetFields',\n    value: function resetFields(ns) {\n      var fields = this.fields;\n\n      var names = ns ? this.getValidFieldsFullName(ns) : this.getAllFieldsName();\n      return names.reduce(function (acc, name) {\n        var field = fields[name];\n        if (field && 'value' in field) {\n          acc[name] = {};\n        }\n        return acc;\n      }, {});\n    }\n  }, {\n    key: 'setFieldMeta',\n    value: function setFieldMeta(name, meta) {\n      this.fieldsMeta[name] = meta;\n    }\n  }, {\n    key: 'setFieldsAsDirty',\n    value: function setFieldsAsDirty() {\n      var _this2 = this;\n\n      Object.keys(this.fields).forEach(function (name) {\n        var field = _this2.fields[name];\n        var fieldMeta = _this2.fieldsMeta[name];\n        if (field && fieldMeta && (0, _utils.hasRules)(fieldMeta.validate)) {\n          _this2.fields[name] = (0, _extends3['default'])({}, field, {\n            dirty: true\n          });\n        }\n      });\n    }\n  }, {\n    key: 'getFieldMeta',\n    value: function getFieldMeta(name) {\n      this.fieldsMeta[name] = this.fieldsMeta[name] || {};\n      return this.fieldsMeta[name];\n    }\n  }, {\n    key: 'getValueFromFields',\n    value: function getValueFromFields(name, fields) {\n      var field = fields[name];\n      if (field && 'value' in field) {\n        return field.value;\n      }\n      var fieldMeta = this.getFieldMeta(name);\n      return fieldMeta && fieldMeta.initialValue;\n    }\n  }, {\n    key: 'getValidFieldsName',\n    value: function getValidFieldsName() {\n      var _this3 = this;\n\n      var fieldsMeta = this.fieldsMeta;\n\n      return fieldsMeta ? Object.keys(fieldsMeta).filter(function (name) {\n        return !_this3.getFieldMeta(name).hidden;\n      }) : [];\n    }\n  }, {\n    key: 'getAllFieldsName',\n    value: function getAllFieldsName() {\n      var fieldsMeta = this.fieldsMeta;\n\n      return fieldsMeta ? Object.keys(fieldsMeta) : [];\n    }\n  }, {\n    key: 'getValidFieldsFullName',\n    value: function getValidFieldsFullName(maybePartialName) {\n      var maybePartialNames = Array.isArray(maybePartialName) ? maybePartialName : [maybePartialName];\n      return this.getValidFieldsName().filter(function (fullName) {\n        return maybePartialNames.some(function (partialName) {\n          return fullName === partialName || (0, _utils.startsWith)(fullName, partialName) && ['.', '['].indexOf(fullName[partialName.length]) >= 0;\n        });\n      });\n    }\n  }, {\n    key: 'getFieldValuePropValue',\n    value: function getFieldValuePropValue(fieldMeta) {\n      var name = fieldMeta.name,\n          getValueProps = fieldMeta.getValueProps,\n          valuePropName = fieldMeta.valuePropName;\n\n      var field = this.getField(name);\n      var fieldValue = 'value' in field ? field.value : fieldMeta.initialValue;\n      if (getValueProps) {\n        return getValueProps(fieldValue);\n      }\n      return (0, _defineProperty3['default'])({}, valuePropName, fieldValue);\n    }\n  }, {\n    key: 'getField',\n    value: function getField(name) {\n      return (0, _extends3['default'])({}, this.fields[name], {\n        name: name\n      });\n    }\n  }, {\n    key: 'getNotCollectedFields',\n    value: function getNotCollectedFields() {\n      var _this4 = this;\n\n      var fieldsName = this.getValidFieldsName();\n      return fieldsName.filter(function (name) {\n        return !_this4.fields[name];\n      }).map(function (name) {\n        return {\n          name: name,\n          dirty: false,\n          value: _this4.getFieldMeta(name).initialValue\n        };\n      }).reduce(function (acc, field) {\n        return (0, _set2['default'])(acc, field.name, (0, _createFormField2['default'])(field));\n      }, {});\n    }\n  }, {\n    key: 'getNestedAllFields',\n    value: function getNestedAllFields() {\n      var _this5 = this;\n\n      return Object.keys(this.fields).reduce(function (acc, name) {\n        return (0, _set2['default'])(acc, name, (0, _createFormField2['default'])(_this5.fields[name]));\n      }, this.getNotCollectedFields());\n    }\n  }, {\n    key: 'getFieldMember',\n    value: function getFieldMember(name, member) {\n      return this.getField(name)[member];\n    }\n  }, {\n    key: 'getNestedFields',\n    value: function getNestedFields(names, getter) {\n      var fields = names || this.getValidFieldsName();\n      return fields.reduce(function (acc, f) {\n        return (0, _set2['default'])(acc, f, getter(f));\n      }, {});\n    }\n  }, {\n    key: 'getNestedField',\n    value: function getNestedField(name, getter) {\n      var fullNames = this.getValidFieldsFullName(name);\n      if (fullNames.length === 0 || // Not registered\n      fullNames.length === 1 && fullNames[0] === name // Name already is full name.\n      ) {\n          return getter(name);\n        }\n      var isArrayValue = fullNames[0][name.length] === '[';\n      var suffixNameStartIndex = isArrayValue ? name.length : name.length + 1;\n      return fullNames.reduce(function (acc, fullName) {\n        return (0, _set2['default'])(acc, fullName.slice(suffixNameStartIndex), getter(fullName));\n      }, isArrayValue ? [] : {});\n    }\n  }, {\n    key: 'isValidNestedFieldName',\n\n\n    // @private\n    // BG: `a` and `a.b` cannot be use in the same form\n    value: function isValidNestedFieldName(name) {\n      var names = this.getAllFieldsName();\n      return names.every(function (n) {\n        return !partOf(n, name) && !partOf(name, n);\n      });\n    }\n  }, {\n    key: 'clearField',\n    value: function clearField(name) {\n      delete this.fields[name];\n      delete this.fieldsMeta[name];\n    }\n  }]);\n  return FieldsStore;\n}();\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this6 = this;\n\n  this.setFieldsInitialValue = function (initialValues) {\n    var flattenedInitialValues = _this6.flattenRegisteredFields(initialValues);\n    var fieldsMeta = _this6.fieldsMeta;\n    Object.keys(flattenedInitialValues).forEach(function (name) {\n      if (fieldsMeta[name]) {\n        _this6.setFieldMeta(name, (0, _extends3['default'])({}, _this6.getFieldMeta(name), {\n          initialValue: flattenedInitialValues[name]\n        }));\n      }\n    });\n  };\n\n  this.getAllValues = function () {\n    var fieldsMeta = _this6.fieldsMeta,\n        fields = _this6.fields;\n\n    return Object.keys(fieldsMeta).reduce(function (acc, name) {\n      return (0, _set2['default'])(acc, name, _this6.getValueFromFields(name, fields));\n    }, {});\n  };\n\n  this.getFieldsValue = function (names) {\n    return _this6.getNestedFields(names, _this6.getFieldValue);\n  };\n\n  this.getFieldValue = function (name) {\n    var fields = _this6.fields;\n\n    return _this6.getNestedField(name, function (fullName) {\n      return _this6.getValueFromFields(fullName, fields);\n    });\n  };\n\n  this.getFieldsError = function (names) {\n    return _this6.getNestedFields(names, _this6.getFieldError);\n  };\n\n  this.getFieldError = function (name) {\n    return _this6.getNestedField(name, function (fullName) {\n      return (0, _utils.getErrorStrs)(_this6.getFieldMember(fullName, 'errors'));\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    return _this6.getFieldMember(name, 'validating');\n  };\n\n  this.isFieldsValidating = function (ns) {\n    var names = ns || _this6.getValidFieldsName();\n    return names.some(function (n) {\n      return _this6.isFieldValidating(n);\n    });\n  };\n\n  this.isFieldTouched = function (name) {\n    return _this6.getFieldMember(name, 'touched');\n  };\n\n  this.isFieldsTouched = function (ns) {\n    var names = ns || _this6.getValidFieldsName();\n    return names.some(function (n) {\n      return _this6.isFieldTouched(n);\n    });\n  };\n};\n\nfunction createFieldsStore(fields) {\n  return new FieldsStore(fields);\n}\nmodule.exports = exports['default'];"]},"metadata":{},"sourceType":"script"}